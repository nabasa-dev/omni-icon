{"version":3,"file":"ErrorObserver-BL-dIQLj.js","names":[],"sources":["../../resources/webcomponents/ErrorObserver.ts"],"sourcesContent":["interface IconErrorDetail {\n\ttype: string;\n\tmessage: string;\n\ticonName: string;\n\telement: HTMLElement;\n}\n\ninterface IconLoadedDetail {\n\ticonName: string;\n\twasError: boolean;\n\telement: HTMLElement;\n}\n\ninterface ErrorHandlers {\n\tclickHandler: (e: Event) => void;\n\tkeyHandler: (e: KeyboardEvent) => void;\n}\n\nexport class ErrorObserver {\n\tprivate errorPanel: HTMLElement | null = null;\n\tprivate currentErrorIcon: HTMLElement | null = null;\n\tprivate clickOutsideHandler: ((event: Event) => void) | null = null;\n\tprivate repositionHandler: (() => void) | null = null;\n\tprivate errorHandlers = new WeakMap<HTMLElement, ErrorHandlers>();\n\tprivate errorDetails = new WeakMap<HTMLElement, IconErrorDetail>();\n\tprivate cssLoaded = false;\n\n\tconstructor() {\n\t\tdocument.addEventListener('omni-icon:error', this.handleErrorEvent);\n\t\tdocument.addEventListener('omni-icon:loaded', this.handleLoadedEvent);\n\t}\n\n\tprivate async loadCSS(): Promise<void> {\n\t\tif (this.cssLoaded) return;\n\t\t\n\t\tthis.cssLoaded = true;\n\t\tconst link = document.createElement('link');\n\t\tlink.rel = 'stylesheet';\n\t\tlink.href = new URL('./ErrorObserver.css', import.meta.url).href;\n\t\tdocument.head.appendChild(link);\n\t}\n\n\tprivate handleErrorEvent = (event: Event): void => {\n\t\tconst detail = (event as CustomEvent<IconErrorDetail>).detail;\n\t\tif (!detail?.element) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setupErrorIcon(detail);\n\t};\n\n\tprivate handleLoadedEvent = (event: Event): void => {\n\t\tconst detail = (event as CustomEvent<IconLoadedDetail>).detail;\n\t\tif (!detail?.element || !detail.wasError) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.cleanupErrorIcon(detail.element);\n\t};\n\n\tprivate setupErrorIcon(detail: IconErrorDetail): void {\n\t\tconst iconElement = detail.element;\n\t\tthis.errorDetails.set(iconElement, detail);\n\n\t\tif (this.errorHandlers.has(iconElement)) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Lazy load CSS only when first error occurs\n\t\tthis.loadCSS();\n\n\t\ticonElement.style.cursor = 'pointer';\n\t\ticonElement.setAttribute('role', 'button');\n\t\ticonElement.setAttribute('aria-expanded', 'false');\n\t\ticonElement.setAttribute('tabindex', '0');\n\n\t\tconst togglePanel = (event: Event) => {\n\t\t\tevent.stopPropagation();\n\t\t\tif (this.currentErrorIcon === iconElement) {\n\t\t\t\tthis.hideErrorPanel();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst latestDetail = this.errorDetails.get(iconElement) ?? detail;\n\t\t\tthis.showErrorPanel(iconElement, latestDetail);\n\t\t};\n\n\t\tconst keyHandler = (event: KeyboardEvent) => {\n\t\t\tif (event.key === 'Enter' || event.key === ' ') {\n\t\t\t\tevent.preventDefault();\n\t\t\t\ttogglePanel(event);\n\t\t\t}\n\t\t};\n\n\t\ticonElement.addEventListener('click', togglePanel);\n\t\ticonElement.addEventListener('keydown', keyHandler);\n\t\tthis.errorHandlers.set(iconElement, { clickHandler: togglePanel, keyHandler });\n\t}\n\n\tprivate showErrorPanel(iconElement: HTMLElement, error: IconErrorDetail): void {\n\t\tif (!this.errorPanel) {\n\t\t\tthis.errorPanel = document.createElement('div');\n\t\t\tthis.errorPanel.className = 'oiwc-error-panel';\n\t\t\tdocument.body.appendChild(this.errorPanel);\n\t\t}\n\n\t\tthis.errorPanel.innerHTML = `\n\t\t\t<div class=\"oiwc-error-panel__header\">\n\t\t\t\t<span class=\"oiwc-error-panel__title\">Omni Icon - ${error.type}</span>\n\t\t\t\t<button class=\"oiwc-error-panel__close\" aria-label=\"Close error message\">Ã—</button>\n\t\t\t</div>\n\t\t\t<p class=\"oiwc-error-panel__meta\">\n\t\t\t\t<strong>Icon:</strong> <code>${error.iconName}</code>\n\t\t\t</p>\n\t\t\t<p class=\"oiwc-error-panel__message\">${error.message}</p>\n\t\t`;\n\n\t\tthis.currentErrorIcon?.setAttribute('aria-expanded', 'false');\n\t\tthis.currentErrorIcon?.removeAttribute('data-oiwc-expanded');\n\n\t\tthis.currentErrorIcon = iconElement;\n\t\ticonElement.setAttribute('aria-expanded', 'true');\n\t\ticonElement.setAttribute('data-oiwc-expanded', 'true');\n\n\t\tthis.errorPanel.style.display = 'block';\n\t\tthis.errorPanel.classList.remove('oiwc-error-panel--visible');\n\t\tthis.positionPanel();\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis.errorPanel?.classList.add('oiwc-error-panel--visible');\n\t\t});\n\n\t\tconst closeBtn = this.errorPanel.querySelector<HTMLButtonElement>('.oiwc-error-panel__close');\n\t\tcloseBtn?.addEventListener(\n\t\t\t'click',\n\t\t\t(event) => {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tthis.hideErrorPanel();\n\t\t\t},\n\t\t\t{ once: true }\n\t\t);\n\n\t\tthis.bindGlobalHandlers();\n\t}\n\n\tprivate hideErrorPanel(): void {\n\t\tif (!this.errorPanel) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.currentErrorIcon) {\n\t\t\tthis.currentErrorIcon.setAttribute('aria-expanded', 'false');\n\t\t\tthis.currentErrorIcon.removeAttribute('data-oiwc-expanded');\n\t\t\tthis.currentErrorIcon = null;\n\t\t}\n\n\t\tthis.errorPanel.classList.remove('oiwc-error-panel--visible');\n\t\tthis.errorPanel.style.display = 'none';\n\t\tthis.unbindGlobalHandlers();\n\t}\n\n\tprivate bindGlobalHandlers(): void {\n\t\tthis.unbindGlobalHandlers();\n\n\t\tthis.clickOutsideHandler = (event: Event) => {\n\t\t\tif (!this.currentErrorIcon || !this.errorPanel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst path = event.composedPath();\n\t\t\tif (!path.includes(this.currentErrorIcon) && !path.includes(this.errorPanel)) {\n\t\t\t\tthis.hideErrorPanel();\n\t\t\t}\n\t\t};\n\n\t\tsetTimeout(() => {\n\t\t\tif (this.clickOutsideHandler) {\n\t\t\t\tdocument.addEventListener('click', this.clickOutsideHandler);\n\t\t\t}\n\t\t}, 0);\n\n\t\tthis.repositionHandler = () => this.positionPanel();\n\t\twindow.addEventListener('scroll', this.repositionHandler, true);\n\t\twindow.addEventListener('resize', this.repositionHandler);\n\t}\n\n\tprivate unbindGlobalHandlers(): void {\n\t\tif (this.clickOutsideHandler) {\n\t\t\tdocument.removeEventListener('click', this.clickOutsideHandler);\n\t\t\tthis.clickOutsideHandler = null;\n\t\t}\n\n\t\tif (this.repositionHandler) {\n\t\t\twindow.removeEventListener('scroll', this.repositionHandler, true);\n\t\t\twindow.removeEventListener('resize', this.repositionHandler);\n\t\t\tthis.repositionHandler = null;\n\t\t}\n\t}\n\n\tprivate positionPanel(): void {\n\t\tif (!this.errorPanel || !this.currentErrorIcon) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst padding = 8;\n\t\tconst iconRect = this.currentErrorIcon.getBoundingClientRect();\n\n\t\tthis.errorPanel.style.visibility = 'hidden';\n\t\tthis.errorPanel.style.display = 'block';\n\t\tconst panelRect = this.errorPanel.getBoundingClientRect();\n\t\tthis.errorPanel.style.visibility = '';\n\n\t\tlet left = iconRect.right + padding + window.scrollX;\n\t\tlet top = iconRect.top + window.scrollY;\n\n\t\tconst viewportRight = window.scrollX + window.innerWidth - padding;\n\t\tif (left + panelRect.width > viewportRight) {\n\t\t\tleft = iconRect.left + window.scrollX - panelRect.width - padding;\n\t\t}\n\n\t\tif (left < padding) {\n\t\t\tleft = padding;\n\t\t}\n\n\t\tconst maxTop = window.scrollY + window.innerHeight - panelRect.height - padding;\n\t\tif (top > maxTop) {\n\t\t\ttop = Math.max(window.scrollY + padding, maxTop);\n\t\t}\n\n\t\tthis.errorPanel.style.left = `${left}px`;\n\t\tthis.errorPanel.style.top = `${top}px`;\n\t}\n\n\tprivate cleanupErrorIcon(iconElement: HTMLElement): void {\n\t\tconst handlers = this.errorHandlers.get(iconElement);\n\t\tif (handlers) {\n\t\t\ticonElement.removeEventListener('click', handlers.clickHandler);\n\t\t\ticonElement.removeEventListener('keydown', handlers.keyHandler);\n\t\t\tthis.errorHandlers.delete(iconElement);\n\t\t}\n\n\t\tthis.errorDetails.delete(iconElement);\n\t\ticonElement.style.cursor = '';\n\t\ticonElement.removeAttribute('role');\n\t\ticonElement.removeAttribute('tabindex');\n\t\ticonElement.removeAttribute('aria-expanded');\n\t\ticonElement.removeAttribute('data-oiwc-expanded');\n\n\t\tif (this.currentErrorIcon === iconElement) {\n\t\t\tthis.hideErrorPanel();\n\t\t}\n\t}\n}\n\n"],"mappings":"AAkBA,IAAa,EAAb,KAA2B,CAC1B,WAAyC,KACzC,iBAA+C,KAC/C,oBAA+D,KAC/D,kBAAiD,KACjD,cAAwB,IAAI,QAC5B,aAAuB,IAAI,QAC3B,UAAoB,GAEpB,aAAc,CACb,SAAS,iBAAiB,kBAAmB,KAAK,iBAAiB,CACnE,SAAS,iBAAiB,mBAAoB,KAAK,kBAAkB,CAGtE,MAAc,SAAyB,CACtC,GAAI,KAAK,UAAW,OAEpB,KAAK,UAAY,GACjB,IAAM,EAAO,SAAS,cAAc,OAAO,CAC3C,EAAK,IAAM,aACX,EAAK,KAAO,IAAA,IAAA,GAAA,IAAA,IAAA,6BAAA,OAAA,KAAA,IAAA,CAAA,KAAA,GAAA,OAAA,KAAA,IAA+C,CAAC,KAC5D,SAAS,KAAK,YAAY,EAAK,CAGhC,iBAA4B,GAAuB,CAClD,IAAM,EAAU,EAAuC,OAClD,GAAQ,SAIb,KAAK,eAAe,EAAO,EAG5B,kBAA6B,GAAuB,CACnD,IAAM,EAAU,EAAwC,OACpD,CAAC,GAAQ,SAAW,CAAC,EAAO,UAIhC,KAAK,iBAAiB,EAAO,QAAQ,EAGtC,eAAuB,EAA+B,CACrD,IAAM,EAAc,EAAO,QAG3B,GAFA,KAAK,aAAa,IAAI,EAAa,EAAO,CAEtC,KAAK,cAAc,IAAI,EAAY,CACtC,OAID,KAAK,SAAS,CAEd,EAAY,MAAM,OAAS,UAC3B,EAAY,aAAa,OAAQ,SAAS,CAC1C,EAAY,aAAa,gBAAiB,QAAQ,CAClD,EAAY,aAAa,WAAY,IAAI,CAEzC,IAAM,EAAe,GAAiB,CAErC,GADA,EAAM,iBAAiB,CACnB,KAAK,mBAAqB,EAAa,CAC1C,KAAK,gBAAgB,CACrB,OAGD,IAAM,EAAe,KAAK,aAAa,IAAI,EAAY,EAAI,EAC3D,KAAK,eAAe,EAAa,EAAa,EAGzC,EAAc,GAAyB,EACxC,EAAM,MAAQ,SAAW,EAAM,MAAQ,OAC1C,EAAM,gBAAgB,CACtB,EAAY,EAAM,GAIpB,EAAY,iBAAiB,QAAS,EAAY,CAClD,EAAY,iBAAiB,UAAW,EAAW,CACnD,KAAK,cAAc,IAAI,EAAa,CAAE,aAAc,EAAa,aAAY,CAAC,CAG/E,eAAuB,EAA0B,EAA8B,CACzE,KAAK,aACT,KAAK,WAAa,SAAS,cAAc,MAAM,CAC/C,KAAK,WAAW,UAAY,mBAC5B,SAAS,KAAK,YAAY,KAAK,WAAW,EAG3C,KAAK,WAAW,UAAY;;wDAE0B,EAAM,KAAK;;;;mCAIhC,EAAM,SAAS;;0CAER,EAAM,QAAQ;IAGtD,KAAK,kBAAkB,aAAa,gBAAiB,QAAQ,CAC7D,KAAK,kBAAkB,gBAAgB,qBAAqB,CAE5D,KAAK,iBAAmB,EACxB,EAAY,aAAa,gBAAiB,OAAO,CACjD,EAAY,aAAa,qBAAsB,OAAO,CAEtD,KAAK,WAAW,MAAM,QAAU,QAChC,KAAK,WAAW,UAAU,OAAO,4BAA4B,CAC7D,KAAK,eAAe,CAEpB,0BAA4B,CAC3B,KAAK,YAAY,UAAU,IAAI,4BAA4B,EAC1D,CAEe,KAAK,WAAW,cAAiC,2BAA2B,EACnF,iBACT,QACC,GAAU,CACV,EAAM,iBAAiB,CACvB,KAAK,gBAAgB,EAEtB,CAAE,KAAM,GAAM,CACd,CAED,KAAK,oBAAoB,CAG1B,gBAA+B,CACzB,KAAK,aAIV,AAGC,KAAK,oBAFL,KAAK,iBAAiB,aAAa,gBAAiB,QAAQ,CAC5D,KAAK,iBAAiB,gBAAgB,qBAAqB,CACnC,MAGzB,KAAK,WAAW,UAAU,OAAO,4BAA4B,CAC7D,KAAK,WAAW,MAAM,QAAU,OAChC,KAAK,sBAAsB,EAG5B,oBAAmC,CAClC,KAAK,sBAAsB,CAE3B,KAAK,oBAAuB,GAAiB,CAC5C,GAAI,CAAC,KAAK,kBAAoB,CAAC,KAAK,WACnC,OAGD,IAAM,EAAO,EAAM,cAAc,CAC7B,CAAC,EAAK,SAAS,KAAK,iBAAiB,EAAI,CAAC,EAAK,SAAS,KAAK,WAAW,EAC3E,KAAK,gBAAgB,EAIvB,eAAiB,CACZ,KAAK,qBACR,SAAS,iBAAiB,QAAS,KAAK,oBAAoB,EAE3D,EAAE,CAEL,KAAK,sBAA0B,KAAK,eAAe,CACnD,OAAO,iBAAiB,SAAU,KAAK,kBAAmB,GAAK,CAC/D,OAAO,iBAAiB,SAAU,KAAK,kBAAkB,CAG1D,sBAAqC,CACpC,AAEC,KAAK,uBADL,SAAS,oBAAoB,QAAS,KAAK,oBAAoB,CACpC,MAG5B,AAGC,KAAK,qBAFL,OAAO,oBAAoB,SAAU,KAAK,kBAAmB,GAAK,CAClE,OAAO,oBAAoB,SAAU,KAAK,kBAAkB,CACnC,MAI3B,eAA8B,CAC7B,GAAI,CAAC,KAAK,YAAc,CAAC,KAAK,iBAC7B,OAGD,IACM,EAAW,KAAK,iBAAiB,uBAAuB,CAE9D,KAAK,WAAW,MAAM,WAAa,SACnC,KAAK,WAAW,MAAM,QAAU,QAChC,IAAM,EAAY,KAAK,WAAW,uBAAuB,CACzD,KAAK,WAAW,MAAM,WAAa,GAEnC,IAAI,EAAO,EAAS,MAAQ,EAAU,OAAO,QACzC,EAAM,EAAS,IAAM,OAAO,QAE1B,EAAgB,OAAO,QAAU,OAAO,WAAa,EACvD,EAAO,EAAU,MAAQ,IAC5B,EAAO,EAAS,KAAO,OAAO,QAAU,EAAU,MAAQ,GAGvD,EAAO,IACV,EAAO,GAGR,IAAM,EAAS,OAAO,QAAU,OAAO,YAAc,EAAU,OAAS,EACpE,EAAM,IACT,EAAM,KAAK,IAAI,OAAO,QAAU,EAAS,EAAO,EAGjD,KAAK,WAAW,MAAM,KAAO,GAAG,EAAK,IACrC,KAAK,WAAW,MAAM,IAAM,GAAG,EAAI,IAGpC,iBAAyB,EAAgC,CACxD,IAAM,EAAW,KAAK,cAAc,IAAI,EAAY,CAChD,IACH,EAAY,oBAAoB,QAAS,EAAS,aAAa,CAC/D,EAAY,oBAAoB,UAAW,EAAS,WAAW,CAC/D,KAAK,cAAc,OAAO,EAAY,EAGvC,KAAK,aAAa,OAAO,EAAY,CACrC,EAAY,MAAM,OAAS,GAC3B,EAAY,gBAAgB,OAAO,CACnC,EAAY,gBAAgB,WAAW,CACvC,EAAY,gBAAgB,gBAAgB,CAC5C,EAAY,gBAAgB,qBAAqB,CAE7C,KAAK,mBAAqB,GAC7B,KAAK,gBAAgB"}